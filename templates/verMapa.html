<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapeo de Dispositivos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .form {
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            margin: 40px auto;
            border-radius: 4px;
            box-shadow: 0 4px 10px 4px rgba(0, 0, 0, 0.3);
        }

        .notificacion {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #05AFF2;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notificacion.mostrar {
            opacity: 1;
            transform: translateY(0);
        }

        .notificacion .cerrar {
            background: none;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-left: 10px;
            cursor: pointer;
            float: right;
        }

        .notificacion .cerrar:hover {
            color: #ffcccc;
        }
    </style>

    <div class="row text-bg-dark p-3 text-center align-items-center" style="width: 100%;">
        <div class="col-12 col-md-4 mb-3 mb-md-0">
            <img class="img-fluid" src="https://www.intercomchile.cl/img/logoazul.png" alt="Logo azul" />
        </div>
        <div class="col-12 col-md-8">
            <h5 class="text-white">Sistema de mapeo de dispositivos</h5>
        </div>
    </div>
</head>

<body>
    <div class="container text-center">
        <div class="row align-items-center mb-2">
            <div class="col-5 text-start">
                <h1>Mapa de Dispositivos Instalados</h1>
            </div>
            <div class="col-7 ms-auto">
                <div class="row">
                    <div class="col-6">
                        <a href="/agregar" class="btn btn-primary m-2">Agregar dispositivo</a>
                    </div>
                    <div class="col-6">
                        <a href="/cerrar" class="btn btn-primary m-2">Cerrar sesión</a>
                    </div>
                </div>
            </div>
        </div>
        <!--Filtros-->
        <div class="row mb-0">
            <nav class="navbar navbar-expand-lg navbar-light bg-light w-100 mb-0">
                <div class="container-fluid mb-0">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarFilters" aria-controls="navbarFilters" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarFilters">
                        <form action="/mapa" method="POST" class="d-flex flex-wrap w-100">
                            <div class="me-3">
                                <label for="exampleFormControlInput1" class="form-label">Nombre caja</label>
                                <select class="form-select" aria-label="Default select example"
                                    id="exampleFormControlInput1" name="exampleFormControlInput1">
                                    <option value="">Todos</option>
                                    {% for nombre in opcionesNombre %}
                                    <option value="{{ nombre[0] }}" {% if nombreSeleccionado==nombre[0] %} selected {%
                                        endif %}>
                                        {{ nombre[0] }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="me-3">
                                <label class="form-label">Número de clientes</label>
                                <div class="d-flex">
                                    <input type="number" class="form-control me-2" id="numeroMinimo" name="numeroMinimo"
                                        value="{{ numeroMinimoSeleccionado }}" placeholder="Mínimo" min="0" max="8"
                                        required>
                                    <input type="number" class="form-control" id="numeroMaximo" name="numeroMaximo"
                                        value="{{ numeroMaximoSeleccionado }}" placeholder="Máximo" min="0" max="8"
                                        required>
                                </div>
                            </div>
                            <div class="me-3">
                                <label for="exampleFormControlInput4" class="form-label">Planta</label>
                                <select class="form-select" aria-label="Default select example"
                                    id="exampleFormControlInput4" name="exampleFormControlInput4">
                                    <option value="">Todas</option>
                                    {% for opcion in opcionesPlanta %}
                                    <option value="{{ opcion[0] }}" {% if plantaSeleccionada==opcion[0] %} selected {%
                                        endif %}>
                                        {{ opcion[0] }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary pl-3 pr-3 m-3">Aplicar filtros</button>
                        </form>
                    </div>
                    <div class="collapse navbar-collapse" id="navbarFilters">
                        <form id="formActualizar" action="/actualizar" method="POST" class="form text-bg-dark py-2">
                            <h4 class="mb-2">Actualizar dispositivo</h4>
                            <div class="mb-2">
                                <label for="exampleFormControlInput5" class="form-label">Ingrese ID</label>
                                <input type="number" class="form-control form-control-sm" name="id" min="1"
                                    id="exampleFormControlInput5" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-sm w-100">Actualizar dispositivo</button>
                            <p class="mt-2 mb-0" style="font-size: 0.9rem;">Si no sabe la ID, haga clic en el marcador.
                            </p>
                        </form>
                    </div>
                </div>
            </nav>
        </div>
        <!--Actualizar-->
    <!--
        <div class="row">
            <div class="col-12 col-lg-6">
                <div class="p-2 mb-3 mt-0">
                    <form id="formActualizar" action="/actualizar" method="POST" class="form text-bg-dark py-2">
                        <h4 class="mb-2">Actualizar dispositivo</h4>
                        <div class="mb-2">
                            <label for="exampleFormControlInput5" class="form-label">Ingrese ID</label>
                            <input type="number" class="form-control form-control-sm" name="id" min="1"
                                id="exampleFormControlInput5" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm w-100">Actualizar dispositivo</button>
                        <p class="mt-2 mb-0" style="font-size: 0.9rem;">Si no sabe la ID, haga clic en el marcador.</p>
                    </form>
                </div>
            </div>
        </div>
    -->
    </div>

    <div class="row" style="height: 200px; width: 100%;">
        <div class="col-12">
            {{ mapaHtml|safe }}
        </div>
    </div>

    <script>
        // Obtiene los elementos de los inputs
        const numeroMinimo = document.getElementById('numeroMinimo');
        const numeroMaximo = document.getElementById('numeroMaximo');
        const id = document.getElementById('exampleFormControlInput5');

        // Agrega un event listener para escuchar cambios en el input de número mínimo
        numeroMinimo.addEventListener('input', function () {
            if (numeroMinimo.value > 8 || numeroMinimo.value < 0) {
                numeroMinimo.value = null;
            }
            // Si el valor del número mínimo es mayor que el número máximo, actualiza el valor máximo
            if (parseInt(numeroMinimo.value) > parseInt(numeroMaximo.value)) {

                numeroMaximo.value = numeroMinimo.value; // Igualamos el máximo al mínimo
            }
        });

        // Agrega un event listener para escuchar cambios en el input de número máximo
        numeroMaximo.addEventListener('input', function () {
            if (numeroMaximo.value > 8 || numeroMaximo.value < 0) {
                numeroMaximo.value = null;
            }
            // Si el valor del número máximo es menor que el número mínimo, actualiza el valor mínimo
            if (parseInt(numeroMaximo.value) < parseInt(numeroMinimo.value)) {
                numeroMinimo.value = numeroMaximo.value; // Igualamos el mínimo al máximo
            }
        });

        // Mostrar notificación
        window.onload = () => {
            const notificacion = document.getElementById('notificacion');
            if (notificacion) {
                notificacion.classList.add('mostrar');
                setTimeout(cerrarNotificacion, 5000); // Ocultar automáticamente después de 5 segundos
            }
        };

        function cerrarNotificacion() {
            const notificacion = document.getElementById('notificacion');
            notificacion.classList.remove('mostrar');
        }

        function cerrarSesion() {
            window.location.href = "/cerrar";
        }

        id.addEventListener('input', function () {
            if (id.value < 1) {
                id.value = null
            }
        })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>